<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.muratec.mcs.mapper.OhbPortRltMapper">
  <resultMap id="BaseResultMap" type="net.muratec.mcs.model.OhbPortRlt">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="OHB_ID" jdbcType="VARCHAR" property="ohbId" />
    <id column="PORT_ID" jdbcType="VARCHAR" property="portId" />
    <result column="OHB_PRIORITY" jdbcType="DECIMAL" property="ohbPriority" />
    <result column="USE_TIME" jdbcType="OTHER" property="useTime" />
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    OHB_ID, PORT_ID, OHB_PRIORITY, USE_TIME
  </sql>
  <select id="selectByExample" parameterType="net.muratec.mcs.model.OhbPortRltExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from OHB_PORT_RLT
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="net.muratec.mcs.model.OhbPortRltKey" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <include refid="Base_Column_List" />
    from OHB_PORT_RLT
    where OHB_ID = #{ohbId,jdbcType=VARCHAR}
      and PORT_ID = #{portId,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="net.muratec.mcs.model.OhbPortRltKey">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from OHB_PORT_RLT
    where OHB_ID = #{ohbId,jdbcType=VARCHAR}
      and PORT_ID = #{portId,jdbcType=VARCHAR}
  </delete>
  <delete id="deleteByExample" parameterType="net.muratec.mcs.model.OhbPortRltExample">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from OHB_PORT_RLT
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="net.muratec.mcs.model.OhbPortRlt">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into OHB_PORT_RLT (OHB_ID, PORT_ID, OHB_PRIORITY,
      USE_TIME)
    values (#{ohbId,jdbcType=VARCHAR}, #{portId,jdbcType=VARCHAR}, #{ohbPriority,jdbcType=DECIMAL},
      #{useTime,jdbcType=OTHER})
  </insert>
  <insert id="insertSelective" parameterType="net.muratec.mcs.model.OhbPortRlt">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into OHB_PORT_RLT
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="ohbId != null">
        OHB_ID,
      </if>
      <if test="portId != null">
        PORT_ID,
      </if>
      <if test="ohbPriority != null">
        OHB_PRIORITY,
      </if>
      <if test="useTime != null">
        USE_TIME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="ohbId != null">
        #{ohbId,jdbcType=VARCHAR},
      </if>
      <if test="portId != null">
        #{portId,jdbcType=VARCHAR},
      </if>
      <if test="ohbPriority != null">
        #{ohbPriority,jdbcType=DECIMAL},
      </if>
      <if test="useTime != null">
        #{useTime,jdbcType=OTHER},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="net.muratec.mcs.model.OhbPortRltExample" resultType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select count(*) from OHB_PORT_RLT
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update OHB_PORT_RLT
    <set>
      <if test="record.ohbId != null">
        OHB_ID = #{record.ohbId,jdbcType=VARCHAR},
      </if>
      <if test="record.portId != null">
        PORT_ID = #{record.portId,jdbcType=VARCHAR},
      </if>
      <if test="record.ohbPriority != null">
        OHB_PRIORITY = #{record.ohbPriority,jdbcType=DECIMAL},
      </if>
      <if test="record.useTime != null">
        USE_TIME = #{record.useTime,jdbcType=OTHER},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update OHB_PORT_RLT
    set OHB_ID = #{record.ohbId,jdbcType=VARCHAR},
      PORT_ID = #{record.portId,jdbcType=VARCHAR},
      OHB_PRIORITY = #{record.ohbPriority,jdbcType=DECIMAL},
      USE_TIME = #{record.useTime,jdbcType=OTHER}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="net.muratec.mcs.model.OhbPortRlt">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update OHB_PORT_RLT
    <set>
      <if test="ohbPriority != null">
        OHB_PRIORITY = #{ohbPriority,jdbcType=DECIMAL},
      </if>
      <if test="useTime != null">
        USE_TIME = #{useTime,jdbcType=OTHER},
      </if>
    </set>
    where OHB_ID = #{ohbId,jdbcType=VARCHAR}
      and PORT_ID = #{portId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="net.muratec.mcs.model.OhbPortRlt">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update OHB_PORT_RLT
    set OHB_PRIORITY = #{ohbPriority,jdbcType=DECIMAL},
      USE_TIME = #{useTime,jdbcType=OTHER}
    where OHB_ID = #{ohbId,jdbcType=VARCHAR}
      and PORT_ID = #{portId,jdbcType=VARCHAR}
  </update>

  <!--　ここより、独自SQLを記載する　-->

  <!-- ロケーション選択部品用 OHBのポートID取得 -->
  <select id="selectPortIdByStockerGrpId" parameterType="java.lang.String" resultType="java.lang.String">
    select distinct
      OPR.PORT_ID AS PORT_ID
    from
      OHB_PORT_RLT OPR
      inner join GRP_RLT GR on OPR.OHB_ID = GR.MEMBER
    where
      GR.GROUP_ID = #{stockerGrpId,jdbcType=VARCHAR}
    order by
      OPR.PORT_ID asc
  </select>

  <!-- OHBポートグループマスタメンテナンス用 複数レコードの一括登録(SQL-346) -->
  <insert id="insertAllOhbPortGroup" parameterType="map">
    insert all
    <foreach collection="ohbPortRltList" index="index" item="item">
      into OHB_PORT_RLT
      <trim prefix="(" suffix=")" suffixOverrides=",">
        <if test="item.ohbId != null">
          OHB_ID,
        </if>
        <if test="item.portId != null">
          PORT_ID,
        </if>
        <if test="item.ohbPriority != null">
          OHB_PRIORITY,
        </if>
      </trim>
      <trim prefix="values (" suffix=")" suffixOverrides=",">
        <if test="item.ohbId != null">
          #{item.ohbId,jdbcType=VARCHAR},
        </if>
        <if test="item.portId != null">
          #{item.portId,jdbcType=VARCHAR},
        </if>
        <if test="item.ohbPriority != null">
          #{item.ohbPriority,jdbcType=DECIMAL},
        </if>
      </trim>
    </foreach>
    select * from dual
  </insert>


  <resultMap id="OhbPortGroupResultMap" type="net.muratec.mcs.model.OhbPortGroupModel">
    <id column="OHB_ID" jdbcType="VARCHAR" property="ohbId" />
    <result column="OHB_NAME" jdbcType="VARCHAR" property="ohbName" />
    <result column="AMHS_ID" jdbcType="VARCHAR" property="amhsId" />
    <result column="OHB_L_STATE" jdbcType="VARCHAR" property="ohbLState" />
    <result column="OHB_L_STATE_SET_TIME" jdbcType="OTHER" property="setTime" />
    <result column="OHB_L_STATE_SET_AUTHOR" jdbcType="VARCHAR" property="setAuthor" />
    <result column="SHAPE_ID" jdbcType="VARCHAR" property="shapeId" />
    <result column="MEMBER" jdbcType="VARCHAR" property="member" />
  </resultMap>

  <!-- OHBポートグループマスタメンテナンス用 OHBポートリスト取得 -->
  <select id="selectModifyOhbPortList" parameterType="net.muratec.mcs.model.Ohb" resultType="net.muratec.mcs.model.OhbPortGroupModifyModel">
    select
      dense_rank() over(order by PORT_ID asc) RowNumber,
      PORT_ID,
      OHB_PRIORITY,
      SELECTED
    from
    (
      select distinct
        P.PORT_ID as PORT_ID,
        0 as OHB_PRIORITY,
        0 as SELECTED
      from
        PORT P,
        CARRIER_SHAPE_RLT CSR,
        OHB_PORT_RLT OPR
      where
        P.AMHS_ID = #{amhsId,jdbcType=VARCHAR} and
        P.PORT_TYPE = 71 and
        P.PORT_ID = CSR.KEY and
        CSR.CARRIER_SHAPE_ID = #{shapeId,jdbcType=DECIMAL} and
        P.PORT_ID not in (
          select
            OPR.PORT_ID
          from
            OHB O,
            OHB_PORT_RLT OPR
          where
            O.OHB_ID = OPR.OHB_ID AND
            O.AMHS_ID = #{amhsId,jdbcType=VARCHAR}
        )
       union
      select
        PORT_ID,
        OHB_PRIORITY as OHB_PRIORITY,
        1 as SELECTED
      from
        OHB_PORT_RLT
      where
        OHB_ID = #{ohbId,jdbcType=VARCHAR}
      order by
        PORT_ID
    )
    order by
      OHB_PRIORITY
  </select>
</mapper>
