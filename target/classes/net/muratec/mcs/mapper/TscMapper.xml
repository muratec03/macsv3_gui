<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.muratec.mcs.mapper.TscMapper">
  <resultMap id="BaseResultMap" type="net.muratec.mcs.model.Tsc">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="TSC_ID" jdbcType="VARCHAR" property="tscId" />
    <result column="LLC_ID" jdbcType="VARCHAR" property="llcId" />
    <result column="HOST_ID" jdbcType="VARCHAR" property="hostId" />
    <result column="TSC_NAME" jdbcType="VARCHAR" property="tscName" />
    <result column="VENDOR_TSC_NAME" jdbcType="VARCHAR" property="vendorTscName" />
    <result column="TSC_MODE" jdbcType="VARCHAR" property="tscMode" />
    <result column="TSC_MODE_SET_TIME" jdbcType="VARCHAR" property="tscModeSetTime" />
    <result column="TSC_MODE_SET_ORIGINATOR" jdbcType="VARCHAR" property="tscModeSetOriginator" />
    <result column="AVAILABLE" jdbcType="VARCHAR" property="available" />
    <result column="ALARM_STATE" jdbcType="VARCHAR" property="alarmState" />
    <result column="CLEAN_LEVEL" jdbcType="VARCHAR" property="cleanLevel" />
    <result column="H_SHOW_STATE" jdbcType="VARCHAR" property="hShowState" />
    <result column="H_SHOW_STATE_SET_TIME" jdbcType="VARCHAR" property="hShowStateSetTime" />
    <result column="DUMMY_FLG" jdbcType="VARCHAR" property="dummyFlg" />
    <result column="DUMMY_SEQ" jdbcType="DECIMAL" property="dummySeq" />
    <result column="E10_STATE" jdbcType="VARCHAR" property="e10State" />
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    TSC_ID, LLC_ID, HOST_ID, TSC_NAME, VENDOR_TSC_NAME, TSC_MODE, TSC_MODE_SET_TIME, 
    TSC_MODE_SET_ORIGINATOR, AVAILABLE, ALARM_STATE, CLEAN_LEVEL, H_SHOW_STATE, H_SHOW_STATE_SET_TIME, 
    DUMMY_FLG, DUMMY_SEQ, E10_STATE
  </sql>
  <select id="selectByExample" parameterType="net.muratec.mcs.model.TscExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from TSC
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from TSC
    where TSC_ID = #{tscId,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from TSC
    where TSC_ID = #{tscId,jdbcType=VARCHAR}
  </delete>
  <delete id="deleteByExample" parameterType="net.muratec.mcs.model.TscExample">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from TSC
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="net.muratec.mcs.model.Tsc">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into TSC (TSC_ID, LLC_ID, HOST_ID, 
      TSC_NAME, VENDOR_TSC_NAME, TSC_MODE, 
      TSC_MODE_SET_TIME, TSC_MODE_SET_ORIGINATOR, AVAILABLE, 
      ALARM_STATE, CLEAN_LEVEL, H_SHOW_STATE, 
      H_SHOW_STATE_SET_TIME, DUMMY_FLG, DUMMY_SEQ, 
      E10_STATE)
    values (#{tscId,jdbcType=VARCHAR}, #{llcId,jdbcType=VARCHAR}, #{hostId,jdbcType=VARCHAR}, 
      #{tscName,jdbcType=VARCHAR}, #{vendorTscName,jdbcType=VARCHAR}, #{tscMode,jdbcType=VARCHAR}, 
      #{tscModeSetTime,jdbcType=VARCHAR}, #{tscModeSetOriginator,jdbcType=VARCHAR}, #{available,jdbcType=VARCHAR}, 
      #{alarmState,jdbcType=VARCHAR}, #{cleanLevel,jdbcType=VARCHAR}, #{hShowState,jdbcType=VARCHAR}, 
      #{hShowStateSetTime,jdbcType=VARCHAR}, #{dummyFlg,jdbcType=VARCHAR}, #{dummySeq,jdbcType=DECIMAL}, 
      #{e10State,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="net.muratec.mcs.model.Tsc">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into TSC
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="tscId != null">
        TSC_ID,
      </if>
      <if test="llcId != null">
        LLC_ID,
      </if>
      <if test="hostId != null">
        HOST_ID,
      </if>
      <if test="tscName != null">
        TSC_NAME,
      </if>
      <if test="vendorTscName != null">
        VENDOR_TSC_NAME,
      </if>
      <if test="tscMode != null">
        TSC_MODE,
      </if>
      <if test="tscModeSetTime != null">
        TSC_MODE_SET_TIME,
      </if>
      <if test="tscModeSetOriginator != null">
        TSC_MODE_SET_ORIGINATOR,
      </if>
      <if test="available != null">
        AVAILABLE,
      </if>
      <if test="alarmState != null">
        ALARM_STATE,
      </if>
      <if test="cleanLevel != null">
        CLEAN_LEVEL,
      </if>
      <if test="hShowState != null">
        H_SHOW_STATE,
      </if>
      <if test="hShowStateSetTime != null">
        H_SHOW_STATE_SET_TIME,
      </if>
      <if test="dummyFlg != null">
        DUMMY_FLG,
      </if>
      <if test="dummySeq != null">
        DUMMY_SEQ,
      </if>
      <if test="e10State != null">
        E10_STATE,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="tscId != null">
        #{tscId,jdbcType=VARCHAR},
      </if>
      <if test="llcId != null">
        #{llcId,jdbcType=VARCHAR},
      </if>
      <if test="hostId != null">
        #{hostId,jdbcType=VARCHAR},
      </if>
      <if test="tscName != null">
        #{tscName,jdbcType=VARCHAR},
      </if>
      <if test="vendorTscName != null">
        #{vendorTscName,jdbcType=VARCHAR},
      </if>
      <if test="tscMode != null">
        #{tscMode,jdbcType=VARCHAR},
      </if>
      <if test="tscModeSetTime != null">
        #{tscModeSetTime,jdbcType=VARCHAR},
      </if>
      <if test="tscModeSetOriginator != null">
        #{tscModeSetOriginator,jdbcType=VARCHAR},
      </if>
      <if test="available != null">
        #{available,jdbcType=VARCHAR},
      </if>
      <if test="alarmState != null">
        #{alarmState,jdbcType=VARCHAR},
      </if>
      <if test="cleanLevel != null">
        #{cleanLevel,jdbcType=VARCHAR},
      </if>
      <if test="hShowState != null">
        #{hShowState,jdbcType=VARCHAR},
      </if>
      <if test="hShowStateSetTime != null">
        #{hShowStateSetTime,jdbcType=VARCHAR},
      </if>
      <if test="dummyFlg != null">
        #{dummyFlg,jdbcType=VARCHAR},
      </if>
      <if test="dummySeq != null">
        #{dummySeq,jdbcType=DECIMAL},
      </if>
      <if test="e10State != null">
        #{e10State,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="net.muratec.mcs.model.TscExample" resultType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select count(*) from TSC
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update TSC
    <set>
      <if test="record.tscId != null">
        TSC_ID = #{record.tscId,jdbcType=VARCHAR},
      </if>
      <if test="record.llcId != null">
        LLC_ID = #{record.llcId,jdbcType=VARCHAR},
      </if>
      <if test="record.hostId != null">
        HOST_ID = #{record.hostId,jdbcType=VARCHAR},
      </if>
      <if test="record.tscName != null">
        TSC_NAME = #{record.tscName,jdbcType=VARCHAR},
      </if>
      <if test="record.vendorTscName != null">
        VENDOR_TSC_NAME = #{record.vendorTscName,jdbcType=VARCHAR},
      </if>
      <if test="record.tscMode != null">
        TSC_MODE = #{record.tscMode,jdbcType=VARCHAR},
      </if>
      <if test="record.tscModeSetTime != null">
        TSC_MODE_SET_TIME = #{record.tscModeSetTime,jdbcType=VARCHAR},
      </if>
      <if test="record.tscModeSetOriginator != null">
        TSC_MODE_SET_ORIGINATOR = #{record.tscModeSetOriginator,jdbcType=VARCHAR},
      </if>
      <if test="record.available != null">
        AVAILABLE = #{record.available,jdbcType=VARCHAR},
      </if>
      <if test="record.alarmState != null">
        ALARM_STATE = #{record.alarmState,jdbcType=VARCHAR},
      </if>
      <if test="record.cleanLevel != null">
        CLEAN_LEVEL = #{record.cleanLevel,jdbcType=VARCHAR},
      </if>
      <if test="record.hShowState != null">
        H_SHOW_STATE = #{record.hShowState,jdbcType=VARCHAR},
      </if>
      <if test="record.hShowStateSetTime != null">
        H_SHOW_STATE_SET_TIME = #{record.hShowStateSetTime,jdbcType=VARCHAR},
      </if>
      <if test="record.dummyFlg != null">
        DUMMY_FLG = #{record.dummyFlg,jdbcType=VARCHAR},
      </if>
      <if test="record.dummySeq != null">
        DUMMY_SEQ = #{record.dummySeq,jdbcType=DECIMAL},
      </if>
      <if test="record.e10State != null">
        E10_STATE = #{record.e10State,jdbcType=VARCHAR},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update TSC
    set TSC_ID = #{record.tscId,jdbcType=VARCHAR},
      LLC_ID = #{record.llcId,jdbcType=VARCHAR},
      HOST_ID = #{record.hostId,jdbcType=VARCHAR},
      TSC_NAME = #{record.tscName,jdbcType=VARCHAR},
      VENDOR_TSC_NAME = #{record.vendorTscName,jdbcType=VARCHAR},
      TSC_MODE = #{record.tscMode,jdbcType=VARCHAR},
      TSC_MODE_SET_TIME = #{record.tscModeSetTime,jdbcType=VARCHAR},
      TSC_MODE_SET_ORIGINATOR = #{record.tscModeSetOriginator,jdbcType=VARCHAR},
      AVAILABLE = #{record.available,jdbcType=VARCHAR},
      ALARM_STATE = #{record.alarmState,jdbcType=VARCHAR},
      CLEAN_LEVEL = #{record.cleanLevel,jdbcType=VARCHAR},
      H_SHOW_STATE = #{record.hShowState,jdbcType=VARCHAR},
      H_SHOW_STATE_SET_TIME = #{record.hShowStateSetTime,jdbcType=VARCHAR},
      DUMMY_FLG = #{record.dummyFlg,jdbcType=VARCHAR},
      DUMMY_SEQ = #{record.dummySeq,jdbcType=DECIMAL},
      E10_STATE = #{record.e10State,jdbcType=VARCHAR}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="net.muratec.mcs.model.Tsc">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update TSC
    <set>
      <if test="llcId != null">
        LLC_ID = #{llcId,jdbcType=VARCHAR},
      </if>
      <if test="hostId != null">
        HOST_ID = #{hostId,jdbcType=VARCHAR},
      </if>
      <if test="tscName != null">
        TSC_NAME = #{tscName,jdbcType=VARCHAR},
      </if>
      <if test="vendorTscName != null">
        VENDOR_TSC_NAME = #{vendorTscName,jdbcType=VARCHAR},
      </if>
      <if test="tscMode != null">
        TSC_MODE = #{tscMode,jdbcType=VARCHAR},
      </if>
      <if test="tscModeSetTime != null">
        TSC_MODE_SET_TIME = #{tscModeSetTime,jdbcType=VARCHAR},
      </if>
      <if test="tscModeSetOriginator != null">
        TSC_MODE_SET_ORIGINATOR = #{tscModeSetOriginator,jdbcType=VARCHAR},
      </if>
      <if test="available != null">
        AVAILABLE = #{available,jdbcType=VARCHAR},
      </if>
      <if test="alarmState != null">
        ALARM_STATE = #{alarmState,jdbcType=VARCHAR},
      </if>
      <if test="cleanLevel != null">
        CLEAN_LEVEL = #{cleanLevel,jdbcType=VARCHAR},
      </if>
      <if test="hShowState != null">
        H_SHOW_STATE = #{hShowState,jdbcType=VARCHAR},
      </if>
      <if test="hShowStateSetTime != null">
        H_SHOW_STATE_SET_TIME = #{hShowStateSetTime,jdbcType=VARCHAR},
      </if>
      <if test="dummyFlg != null">
        DUMMY_FLG = #{dummyFlg,jdbcType=VARCHAR},
      </if>
      <if test="dummySeq != null">
        DUMMY_SEQ = #{dummySeq,jdbcType=DECIMAL},
      </if>
      <if test="e10State != null">
        E10_STATE = #{e10State,jdbcType=VARCHAR},
      </if>
    </set>
    where TSC_ID = #{tscId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="net.muratec.mcs.model.Tsc">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update TSC
    set LLC_ID = #{llcId,jdbcType=VARCHAR},
      HOST_ID = #{hostId,jdbcType=VARCHAR},
      TSC_NAME = #{tscName,jdbcType=VARCHAR},
      VENDOR_TSC_NAME = #{vendorTscName,jdbcType=VARCHAR},
      TSC_MODE = #{tscMode,jdbcType=VARCHAR},
      TSC_MODE_SET_TIME = #{tscModeSetTime,jdbcType=VARCHAR},
      TSC_MODE_SET_ORIGINATOR = #{tscModeSetOriginator,jdbcType=VARCHAR},
      AVAILABLE = #{available,jdbcType=VARCHAR},
      ALARM_STATE = #{alarmState,jdbcType=VARCHAR},
      CLEAN_LEVEL = #{cleanLevel,jdbcType=VARCHAR},
      H_SHOW_STATE = #{hShowState,jdbcType=VARCHAR},
      H_SHOW_STATE_SET_TIME = #{hShowStateSetTime,jdbcType=VARCHAR},
      DUMMY_FLG = #{dummyFlg,jdbcType=VARCHAR},
      DUMMY_SEQ = #{dummySeq,jdbcType=DECIMAL},
      E10_STATE = #{e10State,jdbcType=VARCHAR}
    where TSC_ID = #{tscId,jdbcType=VARCHAR}
  </update>
  <!-- STD APL 2020.02.27 董 天津村研  MCSV4　GUI開発  Ver3.0 Rev.000 -->
  <!-- &lt;&gt; 这是转义字符 <> -->
  <select id="selectTscInfoById" parameterType="net.muratec.mcs.model.Tsc"  resultType="net.muratec.mcs.model.IconInfo" >
    
  SELECT tsc.tsc_id,
  tsc.llc_id,
  tsc.tsc_name,
  tsc.tsc_mode,
  tsc.available,
  tsc.alarm_state,
  NVL(down_ports.down_count, 0) down_count,
  llc.llc_type,
  module.module_name,
  NVL(total, 0) total,
  NVL(total, 0) - NVL(empty, 0) occupied,
  NVL(empty, 0) empty,
  NVL(reserve, 0) reserve
FROM tsc
JOIN llc ON tsc.llc_id   = llc.llc_id AND display_flg = 1
JOIN module ON tsc.llc_id = module.llc_id
LEFT OUTER JOIN   (SELECT p.tsc_id,    COUNT(p.port_id) down_count
  FROM  (SELECT port_id, tsc_id, available, ibsem_avail, port_mode 
  		 FROM port
    	 UNION SELECT ohb_port_id port_id,tsc_id,available,ibsem_avail, ohb_port_mode port_mode FROM ohb_port) p
 		 WHERE (p.available &lt;&gt; 'Available'   
 		 		OR p.ibsem_avail   &lt;&gt; 'Available'
  				OR p.port_mode     &lt;&gt; 'Up')
  		GROUP BY p.tsc_id
  UNION
  SELECT t.tsc_id, COUNT(op.ohb_port_id) down_count
  FROM ohb_port op, tsc t
  WHERE op.set_vendor  = t.llc_id
		  AND set_vendor      IS NOT NULL
		  AND(op.available    &lt;&gt; 'Available'
		  OR op.ibsem_avail   &lt;&gt; 'Available'
		  OR op.ohb_port_mode &lt;&gt; 'Up')
  GROUP BY t.tsc_id
  ) down_ports
ON tsc.tsc_id = down_ports.tsc_id
LEFT OUTER JOIN
  (SELECT stz.tsc_id,
    stz.total,
    stz.empty,
    stres.reserve
  FROM
    (SELECT tsc_id,
      SUM(total_shelves) total,
      SUM(empty_shelves) empty
    FROM stocker_zone
    GROUP BY tsc_id
    ) stz
  LEFT OUTER JOIN
    (SELECT tsc_id, COUNT(tsc_id) reserve FROM stocker_reserve GROUP BY tsc_id
    ) stres
  ON stz.tsc_id = stres.tsc_id
  UNION
  SELECT ohbz.tsc_id tsc_id,
    ohbz.total total,
    ohbz.empty empty,
    ohbres.reserve reserve
  FROM
    (SELECT tsc_id,
      SUM(total_shelves) total,
      SUM(empty_shelves) empty
    FROM ohb_zone
    GROUP BY tsc_id
    ) ohbz
  LEFT OUTER JOIN
    (SELECT tsc_id, COUNT(tsc_id) reserve FROM ohb_reserve GROUP BY tsc_id
    ) ohbres
  ON ohbz.tsc_id          = ohbres.tsc_id
  ) shelves ON tsc.tsc_id = shelves.tsc_id
WHERE tsc_name           IS NOT NULL
	 AND tsc_name             &lt;&gt; 'MGV'
	 AND tsc.llc_id = #{llcId,jdbcType=VARCHAR} 
	 AND tsc.tsc_id =  #{tscId,jdbcType=VARCHAR} 
ORDER BY tsc.tsc_id
</select>
</mapper>